<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H11 Earns</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyA2i7Fj...",
            authDomain: "try-ok-def2b.firebaseapp.com",
            projectId: "try-ok-def2b",
            storageBucket: "try-ok-def2b.firebasestorage.app",
            messagingSenderId: "970681789803",
            appId: "1:970681789803:web:0ee725fa11eac40716702e"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        async function googleLogin() {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                await setDoc(doc(db, "users", user.uid), { balance: 0 }, { merge: true });
                alert("Login Successful");
            } catch (error) {
                alert(error.message);
            }
        }
        
        async function deposit(amount) {
            const user = auth.currentUser;
            if (user) {
                await updateDoc(doc(db, "users", user.uid), { balance: increment(amount) });
                alert(`Deposited ${amount} PKR`);
            }
        }
        
        async function withdraw(amount) {
            const user = auth.currentUser;
            if (user) {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists() && userDoc.data().balance >= amount) {
                    await updateDoc(doc(db, "users", user.uid), { balance: increment(-amount) });
                    alert(`Withdrawal of ${amount} PKR successful`);
                } else {
                    alert("Insufficient Balance");
                }
            }
        }
        
        async function adViewEarn() {
            const user = auth.currentUser;
            if (user) {
                await updateDoc(doc(db, "users", user.uid), { balance: increment(0.50) });
                alert("Earned 0.50 PKR from Ad View");
            }
        }
        
        function logout() {
            signOut(auth).then(() => {
                alert("Logged Out Successfully");
            });
        }
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById("user-status").innerText = `Logged in as ${user.displayName}`;
            } else {
                document.getElementById("user-status").innerText = "Not Logged In";
            }
        });
    </script>
</head>
<body>
    <h1>Welcome to H11 Earns</h1>
    <p id="user-status">Not Logged In</p>
    <button onclick="googleLogin()">Login with Google</button>
    <button onclick="logout()">Logout</button>
    <button onclick="deposit(100)">Deposit 100 PKR</button>
    <button onclick="withdraw(50)">Withdraw 50 PKR</button>
    <button onclick="adViewEarn()">Watch Ad (Earn 0.50 PKR)</button>
</body>
</html>
